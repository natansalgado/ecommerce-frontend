<div *ngIf="user" class="container mt-5">
  <h1>Configurações</h1>
  <div class="card mt-4">
    <div class="card-body">
      <h2>Editar Informações Pessoais</h2>
      <button
        *ngIf="opened != 'infos'"
        (click)="setOpened('infos')"
        class="btn btn-primary mt-3"
      >
        Editar Perfil
      </button>
      <form *ngIf="opened == 'infos'">
        <div class="mb-3">
          <label for="name" class="form-label mt-4">Nome</label>
          <input
            type="text"
            class="form-control"
            id="name"
            value="{{ user.name }}"
          />
        </div>
        <div class="mb-3">
          <label for="email" class="form-label">Email</label>
          <input
            type="email"
            class="form-control"
            id="email"
            value="{{ user.email }}"
          />
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">Senha</label>
          <input type="password" class="form-control" id="password" />
        </div>
        <div class="mb-3">
          <label for="address" class="form-label">Endereço</label>
          <input
            type="text"
            class="form-control"
            id="address"
            value="{{ user.address }}"
          />
        </div>
        <button type="submit" class="btn btn-primary">
          Atualizar informações
        </button>
      </form>
    </div>
  </div>

  <div class="card mt-4 mb-5">
    <div class="card-body">
      <h2>Depósito</h2>

      <div *ngIf="verifying">
        <div class="modal-body text-center mt-2">
          <div class="spinner-border" role="status">
            <span class="sr-only">Carregando...</span>
          </div>
          <h5>Verificando cartão de crédito...</h5>
        </div>
      </div>

      <div *ngIf="!verifying">
        <button
          *ngIf="opened != 'deposit'"
          (click)="setOpened('deposit')"
          class="btn btn-primary mt-3"
        >
          Fazer um depósito
        </button>
        <div *ngIf="opened == 'deposit'">
          <label for="value" class="mt-4">Quantia a ser depositada</label>
          <div class="input-group mb-2">
            <div class="input-group-prepend">
              <div class="input-group-text bg-light"><strong>R$</strong></div>
            </div>
            <input
              type="number"
              class="form-control"
              id="value"
              [(ngModel)]="value"
            />
          </div>

          <h5 class="mt-3 mb-0">Escolha o cartão de crédito:</h5>
          <div class="row mt-3 px-3">
            <div *ngFor="let card of cards" class="col-lg-4 col-md-6">
              <button
                (click)="activeCard(card.id)"
                [ngClass]="{ 'border-primary': card.active }"
                class="py-5 bg-dark bg-gradient-dark text-light m-1 w-100 position-relative"
                style="border-radius: 20px; border: 3px gray solid"
              >
                <button
                  class="btn position-absolute"
                  style="top: 0; right: 0"
                  (click)="deleteCard(card.id)"
                >
                  <h3>
                    <i class="fa fa-close text-danger"></i>
                  </h3>
                </button>
                <h3>**** **** **** {{ card.number }}</h3>
                <div class="d-flex align-items-end justify-content-around">
                  <h3>{{ user.name }}</h3>
                  <h5>{{ card.date }}</h5>
                </div>
              </button>
            </div>
          </div>

          <div *ngIf="depositMessage" class="alert alert-danger mt-2">
            <strong>{{ depositMessage }}</strong>
          </div>

          <div *ngIf="depositSuccessMessage" class="alert alert-success mt-2">
            <strong>{{ depositSuccessMessage }}</strong>
          </div>

          <div class="mt-3">
            <button
              [disabled]="cards.length >= 3"
              (click)="generateCard()"
              class="btn btn-info mr-2 mb-2"
            >
              Adicionar novo cartão
            </button>
            <button
              [disabled]="cards.length < 1 || !someCardActived()"
              (click)="verifyDeposit()"
              class="btn btn-success mb-2"
            >
              Confirmar depósito
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
